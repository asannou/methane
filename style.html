<style>
  /* Color variables for light and dark themes */
  :root {
    /* Light Mode Defaults */
    --text-color: #363636;
    --background-color: #f5f5f5; /* Bulma default background */
    --box-background-color: #ffffff;
    --input-background-color: #ffffff;
    --border-color: #dbdbdb;
    --code-background-color: #eef; /* From #ai-policy pre */
    --spinner-top-color: #3498db; /* Blue */
    --spinner-bottom-color: #f3f3f3; /* Light grey */
    --notification-info-bg: #eff5fb;
    --notification-info-text: #2173b9; /* Darker blue than Bulma's default for info to ensure contrast */
    --notification-danger-bg: #fff0f0;
    --notification-danger-text: #cc0f35; /* Darker red than Bulma's default for danger */
    --diff-equal-bg: #f4f4f4;
    --diff-added-bg: #e6ffe6;
    --diff-removed-bg: #ffe6e6;
    --diff-modified-bg: #fffacd;
    --diff-line-numbers-bg: #eee;
    --diff-line-numbers-color: #888;
  }

  body.dark-mode {
    /* Dark Mode Overrides */
    --text-color: #f5f5f5;
    --background-color: #2c2f33; /* Dark background */
    --box-background-color: #3b3e42; /* Darker box */
    --input-background-color: #4b4f54; /* Darker input */
    --border-color: #55585d;
    --code-background-color: #33363b;
    --spinner-top-color: #61dafb; /* Lighter blue for contrast */
    --spinner-bottom-color: #55585d; /* Dark grey */
    --notification-info-bg: #324354;
    --notification-info-text: #8fb8dd;
    --notification-danger-bg: #5f3e41;
    --notification-danger-text: #e68d9f;
    --diff-equal-bg: #3d4146;
    --diff-added-bg: #355335;
    --diff-removed-bg: #633f3f;
    --diff-modified-bg: #5a5a3a;
    --diff-line-numbers-bg: #4b4f54;
    --diff-line-numbers-color: #aaa;
  }

  /* General body styles */
  body {
    color: var(--text-color);
    background-color: var(--background-color);
    transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition */
  }

  /* Bulma element overrides */
  .title, .label, .content, .checkbox label, .help {
    color: var(--text-color);
  }

  .box {
    background-color: var(--box-background-color);
    border: 1px solid var(--border-color);
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }

  .input, .textarea, .select select {
    background-color: var(--input-background-color);
    border-color: var(--border-color);
    color: var(--text-color);
    transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
  }

  .input::placeholder, .textarea::placeholder {
    color: var(--text-color); /* Adjust placeholder color for dark mode */
    opacity: 0.7;
  }

  /* Notification overrides */
  .notification.is-light.is-info {
    background-color: var(--notification-info-bg);
    color: var(--notification-info-text);
    border-color: var(--notification-info-text); /* Border for info notification */
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
  }

  .notification.is-danger.is-light {
    background-color: var(--notification-danger-bg);
    color: var(--notification-danger-text);
    border-color: var(--notification-danger-text); /* Border for danger notification */
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
  }

  /* Bulma buttons: Generally good, but custom buttons might need adjustment */
  .button.is-primary { background-color: #00d1b2; border-color: transparent; color: #fff; } /* Bulma's primary */
  .button.is-primary:hover { background-color: #00c4a7; }
  .dark-mode .button.is-primary { background-color: #4CAF50; color: #fff; } /* Example: slightly different primary in dark mode */
  .dark-mode .button.is-primary:hover { background-color: #45a049; }

  /* Keep custom spinner styles as Bulma doesn't provide them */
  .spinner {
    border: 4px solid var(--spinner-bottom-color); /* Light grey */
    border-top: 4px solid var(--spinner-top-color); /* Blue */
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    margin: 10px auto; /* Center the spinner */
    display: block; /* Ensure it's a block element for margin: auto to work */
    transition: border-color 0.3s ease;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* The small spinner in editor-url-display needs specific override */
  #editor-url-display .spinner {
    width: 14px;
    height: 14px;
    margin: 0 5px;
    display: inline-block; /* Override for inline context */
    vertical-align: middle;
  }

  /* Layout for diff-like display - Custom, keep these */
  .file-comparison {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    border: 1px solid var(--border-color);
    padding: 10px;
    background-color: var(--background-color); /* Use background variable */
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }
  .file-comparison div {
    flex: 1 1 50%; /* Adjust to ensure each panel takes roughly 50% width */
    margin: 0 5px;
  }
  .file-comparison h4 {
    margin-top: 0;
    color: var(--text-color);
  }
  .file-comparison pre {
    height: 250px; /* Increased height for more lines */
    overflow-y: scroll;
    overflow-x: auto; /* ADDED: Enable horizontal scrolling for long lines */
    border: 1px solid var(--border-color);
    display: flex; /* Use flexbox for line numbers */
    transition: border-color 0.3s ease;
  }

  /* Styles for line numbers and code content columns - Custom, keep these */
  .line-numbers-col {
    background-color: var(--diff-line-numbers-bg);
    color: var(--diff-line-numbers-color);
    text-align: right;
    user-select: none;
    flex-shrink: 0;
    width: max-content; /* Ensure width is natural based on content */
    border-right: 1px solid var(--border-color); /* Use general border color */
    font-family: monospace;
    font-size: 0.9em;
    line-height: 1.4;
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
  }
  .code-content-col {
    flex-grow: 1;
    font-family: monospace;
    font-size: 0.9em;
    line-height: 1.4;
  }

  /* NEW: Styles for individual line divs within the pre blocks - Custom, keep these */
  .line-numbers-col > div,
  .code-content-col > div {
    padding: 0 5px; /* Apply padding directly to each line div */
    min-height: 1.4em; /* Ensure consistent height for each line, including empty ones */
    box-sizing: border-box; /* Include padding in element's total width/height */
    transition: background-color 0.3s ease;
  }

  /* Specific diff line highlighting - Custom, keep these */
  .code-content-col > .diff-line-equal { background-color: var(--diff-equal-bg); }
  .code-content-col > .diff-line-added { background-color: var(--diff-added-bg); }
  .code-content-col > .diff-line-removed { background-color: var(--diff-removed-bg); }
  .code-content-col > .diff-line-modified { background-color: var(--diff-modified-bg); }
  .code-content-col > .diff-line-empty-fill { background-color: transparent; }

  /* Styles for Markdown rendered content in ai-policy div */
  #ai-policy {
    background-color: var(--box-background-color);
    padding: 15px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    margin-bottom: 20px;
    line-height: 1.6;
    word-break: break-word; /* 長い単語やURLがはみ出すのを防ぎ、自動で改行します */
    overflow-x: auto; /* コンテンツが幅を超える場合に水平スクロールバーを表示します */
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }

  #ai-policy pre {
    background-color: var(--code-background-color);
    padding: 10px;
    border-radius: 4px;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-x: auto;
    font-family: monospace;
    font-size: 0.9em;
    line-height: 1.4;
    transition: background-color 0.3s ease;
  }

  /* Dark mode toggle switch styles */
  .dark-mode-toggle {
    display: flex;
    align-items: center;
    justify-content: flex-end; /* Align to right */
    margin-bottom: 20px;
    margin-top: -20px; /* Pull it up a bit to align with title */
  }

  .dark-mode-toggle label {
    font-weight: bold;
    margin-right: 10px;
    color: var(--text-color);
  }

  /* The switch - the box around the slider */
  .switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
  }

  /* Hide default HTML checkbox */
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  /* The slider */
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
    border-radius: 34px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: #2196F3;
  }

  input:focus + .slider {
    box-shadow: 0 0 1px #2196F3;
  }

  input:checked + .slider:before {
    -webkit-transform: translateX(26px);
    -ms-transform: translateX(26px);
    transform: translateX(26px);
  }

  /* Rounded sliders */
  .slider.round {
    border-radius: 34px;
  }

  .slider.round:before {
    border-radius: 50%;
  }
</style>